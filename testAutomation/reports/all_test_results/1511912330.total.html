[4mRunning "env:test" (env) task[24m

[4mRunning "mochaTest:kmp_id" (mochaTest) task[24m

[0m[0m
[0m  Survey Model[0m
[0m    isNew() check[0m
    [31m  1) Test 01(fault) : submission is rejected if id is undefined[0m

[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test 02 : submission is rejected if id is null[0m

[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test 03 : submission is rejected if id is false[0m

[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test 04 : submission returns true for not-previously logged submissions[0m

[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test 05: submission returns false for previously logged submissions[0m


[92m [0m[32m 4 passing[0m[90m (204ms)[0m
[31m  1 failing[0m

[0m  1) Survey Model isNew() check Test 01(fault) : submission is rejected if id is undefined:

      [31mAssertionError: expected 400 to equal 404[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-400[0m
      [32m+404[0m
      [0m[90m
    at getBasePromise.then.then.newArgs (node_modules/chai-as-promised/lib/chai-as-promised.js:302:22)
    at Array.<anonymous> (node_modules/lie/lib/index.js:88:21)
    at nextTick (node_modules/immediate/lib/index.js:61:18)
    at _combinedTickCallback (internal/process/next_tick.js:73:7)
    at process._tickDomainCallback (internal/process/next_tick.js:128:9)
  
[0m


[33mWarning: Task "mochaTest:kmp_id" failed. Use --force to continue.[39m

[31mAborted due to warnings.[39m


[4mExecution Time[24m[90m (2017-11-28 23:39:00 UTC-0)[39m
loading tasks     [34m25.6s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ 89%[39m
mochaTest:kmp_id   [34m3.3s[39m  [34mâ–‡â–‡â–‡â–‡â–‡ 11%[39m
[35mTotal 28.9s[39m

[4mRunning "env:test" (env) task[24m

[4mRunning "mochaTest:kmp_instanceId" (mochaTest) task[24m

[0m[0m
[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test: 06 submission is rejected if instanceId is undefined[0m

[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test: 07 submission is rejected if instanceId is null[0m

[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test: 08 submission is rejected if instanceId is false[0m

[0m  Survey Model[0m
[0m    isNew() check[0m
    [32m  âœ“[0m[90m Test: 009 is rejected if instanceId is undefined[0m


[92m [0m[32m 4 passing[0m[90m (75ms)[0m


[4mRunning "karma:headless" (karma) task[24m
[32m28 11 2017 23:39:57.949:INFO [framework.browserify]: [39mbundle built
[32m28 11 2017 23:39:58.012:INFO [karma]: [39mKarma v1.7.1 server started at http://0.0.0.0:9876/
[32m28 11 2017 23:39:58.014:INFO [launcher]: [39mLaunching browser ChromeHeadless with unlimited concurrency
[32m28 11 2017 23:39:58.217:INFO [launcher]: [39mStarting browser ChromeHeadless
[31m28 11 2017 23:39:58.236:ERROR [launcher]: [39mNo binary for ChromeHeadless browser on your platform.
  Please, set "CHROME_BIN" env variable.
[33mWarning: Task "karma:headless" failed. Use --force to continue.[39m

[31mAborted due to warnings.[39m


[4mExecution Time[24m[90m (2017-11-28 23:39:35 UTC-0)[39m
loading tasks             [34m14.8s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ 66%[39m
mochaTest:kmp_instanceId  [34m295ms[39m  [34mâ–‡ 1%[39m
karma:headless             [34m7.3s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ 32%[39m
[35mTotal 22.4s[39m

[4mRunning "env:test" (env) task[24m

[4mRunning "mochaTest:kmp_set_survey" (mochaTest) task[24m

[0m[0m
[0m  Survey Model[0m
[0m    set: when attempting to store new surveys[0m
    [32m  âœ“[0m[90m Test 015: store_survey returns an error if the OpenRosa Form ID is missing[0m

[0m  Survey Model[0m
[0m    set: when attempting to store new surveys[0m
    [32m  âœ“[0m[90m Test 016: store_survey returns an error if the OpenRosa Form ID is an empty string[0m

[0m  Survey Model[0m
[0m    set: when attempting to store new surveys[0m
    [32m  âœ“[0m[90m Test 017:  store_survey returns an error if the OpenRosa Server is an empty string[0m

[0m  Survey Model[0m
[0m    set: when attempting to store new surveys[0m
    [32m  âœ“[0m[90m Test 018:  store_survey returns an enketo id if survey is stored successfully[0m

[0m  Survey Model[0m
[0m    set: when attempting to store new surveys[0m
    [32m  âœ“[0m[90m Test 014: store_survey returns an error if the OpenRosa Server is missing[0m


[92m [0m[32m 5 passing[0m[90m (83ms)[0m


[4mRunning "karma:headless" (karma) task[24m
[32m28 11 2017 23:40:21.690:INFO [framework.browserify]: [39mbundle built
[32m28 11 2017 23:40:21.709:INFO [karma]: [39mKarma v1.7.1 server started at http://0.0.0.0:9876/
[32m28 11 2017 23:40:21.710:INFO [launcher]: [39mLaunching browser ChromeHeadless with unlimited concurrency
[32m28 11 2017 23:40:21.740:INFO [launcher]: [39mStarting browser ChromeHeadless
[31m28 11 2017 23:40:21.802:ERROR [launcher]: [39mNo binary for ChromeHeadless browser on your platform.
  Please, set "CHROME_BIN" env variable.
[33mWarning: Task "karma:headless" failed. Use --force to continue.[39m

[31mAborted due to warnings.[39m


[4mExecution Time[24m[90m (2017-11-28 23:40:05 UTC-0)[39m
loading tasks               [34m11s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ 66%[39m
mochaTest:kmp_set_survey  [34m513ms[39m  [34mâ–‡â–‡ 3%[39m
karma:headless             [34m5.2s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ 31%[39m
[35mTotal 16.7s[39m

[4mRunning "env:test" (env) task[24m

[4mRunning "mochaTest:kmp_cache_instance" (mochaTest) task[24m

[0m[0m
[0m  Instance Model[0m
[0m    set: when attempting to cache an instance[0m
    [32m  âœ“[0m[90m Test 019: cache_instance returns an 400 error when instanceId is missing[0m

[0m  Instance Model[0m
[0m    set: when attempting to cache an instance[0m
    [32m  âœ“[0m[90m Test 020: cache_instance returns an 400 error when openRosaId is missing[0m

[0m  Instance Model[0m
[0m    set: when attempting to cache an instance[0m
    [32m  âœ“[0m[90m Test 021: cache_instance returns an 400 error when openRosaServer is missing[0m

[0m  Instance Model[0m
[0m    set: when attempting to cache an instance[0m
    [32m  âœ“[0m[90m Test 022: cache_instance returns an 400 error when instance is missing[0m

[0m  Instance Model[0m
[0m    set: when attempting to cache an instance[0m
    [31m  1) Test 023(fault): cache_instance returns the survey object when the instance is cached successfully[0m

[0m  Instance Model[0m
[0m    set: when attempting to cache an instance[0m
    [31m  2) Test 024: get_cached_instance returns an 400 error when instanceId is missing[0m


[92m [0m[32m 4 passing[0m[90m (83ms)[0m
[31m  2 failing[0m

[0m  1) Instance Model set: when attempting to cache an instance Test 023(fault): cache_instance returns the survey object when the instance is cached successfully:
[0m[31m     Error: Bad request. Survey information not complete or invalid[0m[90m
    at app/models/instance-model.js:25:21
    at tryToUnwrap (node_modules/lie/lib/index.js:171:5)
    at tryCatch (node_modules/lie/lib/index.js:183:17)
    at safelyResolveThenable (node_modules/lie/lib/index.js:174:16)
    at new Promise (node_modules/lie/lib/index.js:32:5)
    at Object._cacheInstance [as set] (app/models/instance-model.js:23:12)
    at Context.<anonymous> (test/server/cache_instance-18.spec.js:43:34)
  
[0m
[0m  2) Instance Model set: when attempting to cache an instance Test 024: get_cached_instance returns an 400 error when instanceId is missing:

      [31mAssertionError: expected 400 to equal 404[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-400[0m
      [32m+404[0m
      [0m[90m
    at getBasePromise.then.then.newArgs (node_modules/chai-as-promised/lib/chai-as-promised.js:302:22)
    at Array.<anonymous> (node_modules/lie/lib/index.js:88:21)
    at nextTick (node_modules/immediate/lib/index.js:61:18)
    at _combinedTickCallback (internal/process/next_tick.js:73:7)
    at process._tickDomainCallback (internal/process/next_tick.js:128:9)
  
[0m


[33mWarning: Task "mochaTest:kmp_cache_instance" failed. Use --force to continue.[39m

[31mAborted due to warnings.[39m


[4mExecution Time[24m[90m (2017-11-28 23:40:24 UTC-0)[39m
loading tasks                  [34m2.9s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ 88%[39m
mochaTest:kmp_cache_instance  [34m377ms[39m  [34mâ–‡â–‡â–‡â–‡ 11%[39m
[35mTotal 3.3s[39m

[4mRunning "env:test" (env) task[24m

[4mRunning "mochaTest:kmp_obtain_cached_instance" (mochaTest) task[24m

[0m[0m
[0m  Instance Model[0m
[0m    get: when attempting to obtain a cached instance[0m
    [32m  âœ“[0m[90m Test 25 : obtain_cached_instance returns an 400 error when instanceId is missing[0m

[0m  Instance Model[0m
[0m    get: when attempting to obtain a cached instance[0m
    [32m  âœ“[0m[90m Test 26 : obtain_cached_instance returns an 404 error when instance record not cached[0m

[0m  Instance Model[0m
[0m    get: when attempting to obtain a cached instance[0m
    [32m  âœ“[0m[90m Test 27 : obtain_cached_instance returns the survey object with the instance property when successful[0m


[92m [0m[32m 3 passing[0m[90m (200ms)[0m


[4mRunning "karma:headless" (karma) task[24m
[32m28 11 2017 23:40:35.203:INFO [framework.browserify]: [39mbundle built
[32m28 11 2017 23:40:35.238:INFO [karma]: [39mKarma v1.7.1 server started at http://0.0.0.0:9876/
[32m28 11 2017 23:40:35.243:INFO [launcher]: [39mLaunching browser ChromeHeadless with unlimited concurrency
[32m28 11 2017 23:40:35.256:INFO [launcher]: [39mStarting browser ChromeHeadless
[31m28 11 2017 23:40:35.632:ERROR [launcher]: [39mNo binary for ChromeHeadless browser on your platform.
  Please, set "CHROME_BIN" env variable.
[33mWarning: Task "karma:headless" failed. Use --force to continue.[39m

[31mAborted due to warnings.[39m


[4mExecution Time[24m[90m (2017-11-28 23:40:29 UTC-0)[39m
loading tasks              [34m1.7s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡ 25%[39m
mochaTest:k...d_instance  [34m354ms[39m  [34mâ–‡â–‡ 5%[39m
karma:headless             [34m4.6s[39m  [34mâ–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡ 69%[39m
[35mTotal 6.7s[39m

